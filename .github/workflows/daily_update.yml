name: Market Guardian Auto-Update

# 1. DISPARADORES (Triggers)
on:
  schedule:
    # Ejecutar todos los dÃ­as a las 23:00 UTC (Cierre mercado)
    - cron: '0 23 * * *'
  workflow_dispatch: # Â¡Esto aÃ±ade un BOTÃ“N para ejecutarlo manual!

# 2. PERMISOS (Para que el Bot pueda guardar los CSV)
permissions:
  contents: write

# 3. EL TRABAJO
jobs:
  run-etl:
    runs-on: ubuntu-latest
    
    steps:
      # A. Descargar tu cÃ³digo en la mÃ¡quina virtual
      - name: Checkout repository
        uses: actions/checkout@v4

      # B. Instalar Java (Obligatorio para PySpark)
      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      # C. Instalar Python
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      # D. Instalar LibrerÃ­as
      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      # E. EJECUTAR EL ETL SPARk
      - name: Run PySpark ETL
        run: python src/etl_spark.py

      # F. Guardar cambios (Si los hay)
      - name: Commit and Push changes
        run: |
          git config --global user.name 'MarketBot'
          git config --global user.email 'bot@marketguardian.com'
          git add data_kpi.csv data_history.csv data_macro.csv
          # El "|| exit 0" evita que falle si no hay datos nuevos ese dÃ­a
          git commit -m "ðŸ“ˆ Auto-update: Datos financieros diarios" || exit 0
          git push
